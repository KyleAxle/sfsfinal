<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dean of CCIS Office Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #e9effa; }
        .dashboard-card { background: #fff; border-radius: 16px; padding: 2rem; box-shadow: 0 2px 12px 0 rgba(31,41,55,0.08);}
        .table th { color: #2563eb; font-weight: 700; }
        .badge-pending { background: #ffe066; color: #856404; font-weight: 600; }
        .badge-approved { background: #51cf66; color: #155724; font-weight: 600; }
        .badge-rejected { background: #ff6b6b; color: #fff; font-weight: 600; }
    </style>
</head>
<body>
<div class="container py-4">
    <div class="dashboard-card">
        <h2 class="mb-4" style="color:#2563eb;font-weight:700;">Dean of CCIS Office Appointments</h2>
        <div class="table-responsive">
            <table class="table align-middle">
                <thead>
                    <tr>
                        <th>Office</th>
                        <th>User ID</th>
                        <th>Last Name</th>
                        <th>First Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Appointment Date</th>
                        <th>Appointment Time</th>
                        <th>Concern</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="appointmentsBody">
                    <!-- Table rows will be loaded here by JS -->
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    // Fetch table rows from PHP and insert into tbody
    fetch('deanofccis_dashboard.php')
        .then(res => res.text())
        .then(html => {
            document.getElementById('appointmentsBody').innerHTML = html;
        });
        document.addEventListener('click', function(e) {
    if (e.target.classList.contains('approve-btn') || e.target.classList.contains('decline-btn')) {
        const phone = e.target.getAttribute('data-phone');
        const name = e.target.getAttribute('data-name');
        const action = e.target.classList.contains('approve-btn') ? 'approved' : 'declined';
        const message = `Hello ${name}, your appointment has been ${action} by the Dean of CCIS.`;

        fetch('send_sms.php', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `phone_number=${encodeURIComponent(phone)}&message=${encodeURIComponent(message)}`
        })
        .then(res => res.json())
        .then(data => {
            if ((data.success && data.success === true) || data.status === 200) {
                alert('SMS sent successfully!');
            } else {
                alert('SMS failed: ' + (data.error || JSON.stringify(data) || 'Unknown error'));
            }
        })
        .catch(() => alert('SMS sending failed due to network error.'));
    }
});
</script>
</body>
</html>