<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Appointments</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #e9effd;
        }

        .dashboard-container {
            max-width: 100%;
            width: 1800px;
            margin: 40px auto;
            background: #fff;
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(31, 41, 55, 0.12);
            padding: 2rem;
            display: flex;
            gap: 2rem;
        }

        .office-list {
            min-width: 220px;
            border-right: 2px solid #e3e8f0;
            padding-right: 1.5rem;
        }

        .office-list .office-item {
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2563eb;
            background: #f1f5ff;
            transition: background 0.2s, color 0.2s;
        }

        .office-list .office-item.active,
        .office-list .office-item:hover {
            background: #2563eb;
            color: #fff;
        }

        .appointments-section {
            flex: 1;
            width: 100%;
            min-width: 0;
        }

        .appointments-section h2 {
            color: #2563eb;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        .table thead {
            background: #2563eb;
            color: #fff;
        }

        .badge-pending {
            background: #facc15;
            color: #212529;
            font-weight: 600;
        }

        .badge-completed {
            background: #2563eb;
            color: #fff;
            font-weight: 600;
        }

        .table th,
        .table td {
            font-size: 0.95rem;
            padding: 0.35rem 0.5rem;
            vertical-align: middle;
            white-space: nowrap;
        }

        .table td {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .table td.email,
        .table td.concern {
            white-space: normal;
            max-width: 220px;
        }

        .table-responsive {
            width: 100%;
            overflow-x: auto;
        }

        @media (max-width: 1200px) {
            .dashboard-container {
                width: 100vw;
                max-width: 100vw;
                padding: 1rem;
            }

            .table th,
            .table td {
                font-size: 0.90rem;
                padding: 0.25rem 0.3rem;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="office-list">
            <div class="office-item active" data-office="registrar">Registrar Office</div>
            <div class="office-item" data-office="ccis office">CCIS Office</div>
            <div class="office-item" data-office="cashier">Cashier Office</div>
            <div class="office-item" data-office="dean of ccis">Dean (CCIS Office)</div>
            <div class="office-item" data-office="guidance">Guidance Office</div>
            <div class="office-item" data-office="assessment">Assessment Office</div>
        </div>
        <div class="appointments-section">
            <h2 id="officeTitle">Registrar Office Appointments</h2>
            <div class="table-responsive">
                <table class="table align-middle">
                    <thead id="appointmentsTableHead"></thead>
                    <tbody id="appointmentsTable">
                        <!-- Appointments will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        // Define columns for each office
        const officeColumns = {
            "registrar": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "paper_type", label: "Paper Type" },
                { key: "processing_days", label: "Processing Days" },
                { key: "release_date", label: "Release Date" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ],
            "ccis office": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ],
            "cashier": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ],
            "dean of ccis": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ],
            "guidance": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ],
            "assessment": [
                { key: "office", label: "Office" },
                { key: "user_id", label: "User ID" },
                { key: "last_name", label: "Last Name" },
                { key: "first_name", label: "First Name" },
                { key: "email", label: "Email" },
                { key: "appointment_date", label: "Appointment Date" },
                { key: "appointment_time", label: "Appointment Time" },
                { key: "concern", label: "Concern" },
                { key: "status", label: "Status" }
            ]
        };

        function renderAppointments(office) {
            const columns = officeColumns[office] || officeColumns["registrar"];

            // Render table header
            let theadHtml = "<tr>";
            columns.forEach(col => {
                theadHtml += `<th>${col.label}</th>`;
            });
            theadHtml += "</tr>";
            document.querySelector("#appointmentsTableHead").innerHTML = theadHtml;

            // Fetch and render table body
            const table = document.getElementById('appointmentsTable');
            table.innerHTML = `<tr><td colspan="${columns.length}" class="text-center text-muted">Loading...</td></tr>`;
            document.getElementById('officeTitle').textContent = document.querySelector(`.office-item[data-office="${office}"]`).textContent + " Appointments";
            fetch('get_appointments.php?office=' + encodeURIComponent(office))
                .then(res => res.json())
                .then(data => {
                    let html = "";
                    if (data.length === 0) {
                        html = `<tr><td colspan="${columns.length}" class="text-center text-muted">No appointments found.</td></tr>`;
                    } else {
                        data.forEach(app => {
                            html += "<tr>";
                            columns.forEach(col => {
                                let value = app[col.key] || "-";
                                if (col.key === "status") {
                                    value = value === "Completed"
                                        ? '<span class="badge badge-completed">Completed</span>'
                                        : `<span class="badge badge-pending">${value}</span>`;
                                }
                                html += `<td>${value}</td>`;
                            });
                            html += "</tr>";
                        });
                    }
                    table.innerHTML = html;
                });
        }

        // Office click event
        document.querySelectorAll('.office-item').forEach(item => {
            item.addEventListener('click', function () {
                document.querySelectorAll('.office-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                renderAppointments(this.getAttribute('data-office'));
            });
        });
        const activeOffice = document.querySelector('.office-item.active').getAttribute('data-office');
        renderAppointments(activeOffice);
    </script>
</body>

</html>